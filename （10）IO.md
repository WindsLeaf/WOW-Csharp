# IO

文件和流 I/O（输入/输出）是指在存储媒介中传入或传出数据。 在 .NET 中，`System.IO` 命名空间包含允许以异步方式和同步方式对数据流和文件进行读取和写入操作的类型。 这些命名空间还包含对文件执行压缩和解压缩的类型，以及通过管道和串行端口启用通信的类型。

关于IO，其实理解和使用起来很简单，但是涉及到的类很多，所以讲述起来会显得很复杂。

## DriveInfo 驱动器

`System.IO.DriveInfo`类，是关于驱动器的，可以通过此类获取驱动器的各种信息。

### 初始化

可以通过构造函数`DriveInfo(String)`来获取一个驱动器的实例。

```c#
DriveInfo driveInfo = new DriveInfo("C"); // 实例化C盘的driveinfo
```

参数为驱动器的名称，比如说C盘的名称就是C。

获取驱动器实例的方式还有一个就是使用静态方法`DriveInfo.GetDrives()`，这会获得一个由DriveInfo实例化对象构成的数组，该数组包含所有的驱动器。

```c#
DriveInfo[] driveInfos = DriveInfo.GetDrives();
Array.ForEach<DriveInfo>(driveInfos, item =>
{
    Console.WriteLine(item.Name);
});
```

### 属性和方法

DriveInfo的方法不多，主要是属性，可以根据这些属性获取驱动器的各种信息。可以参考[DriveInfo 类 (System.IO) | Microsoft Docs](https://docs.microsoft.com/zh-cn/dotnet/api/system.io.driveinfo?view=net-6.0#properties)。这里列几个常用的属性

| [DriveFormat](https://docs.microsoft.com/zh-cn/dotnet/api/system.io.driveinfo.driveformat?view=net-6.0#System_IO_DriveInfo_DriveFormat) | 获取文件系统的名称，例如 NTFS 或 FAT32。         |
| ------------------------------------------------------------ | ------------------------------------------------ |
| [DriveType](https://docs.microsoft.com/zh-cn/dotnet/api/system.io.driveinfo.drivetype?view=net-6.0#System_IO_DriveInfo_DriveType) | 获取驱动器类型，如 CD-ROM、可移动、网络或固定。  |
| [Name](https://docs.microsoft.com/zh-cn/dotnet/api/system.io.driveinfo.name?view=net-6.0#System_IO_DriveInfo_Name) | 获取驱动器的名称，如 C:\。                       |
| [RootDirectory](https://docs.microsoft.com/zh-cn/dotnet/api/system.io.driveinfo.rootdirectory?view=net-6.0#System_IO_DriveInfo_RootDirectory) | 获取驱动器的根目录。                             |
| [TotalFreeSpace](https://docs.microsoft.com/zh-cn/dotnet/api/system.io.driveinfo.totalfreespace?view=net-6.0#System_IO_DriveInfo_TotalFreeSpace) | 获取驱动器上的可用空闲空间总量（以字节为单位）。 |
| [TotalSize](https://docs.microsoft.com/zh-cn/dotnet/api/system.io.driveinfo.totalsize?view=net-6.0#System_IO_DriveInfo_TotalSize) | 获取驱动器上存储空间的总大小（以字节为单位）。   |

DEMO如下：

```c#
DriveInfo driveInfo = new DriveInfo("C"); // 实例化C盘的driveinfo
Console.WriteLine($"driveInfo.GetType()\t{driveInfo.GetType()}");
Console.WriteLine($"驱动器名称\t{driveInfo.Name}");
Console.WriteLine($"驱动器类型\t{driveInfo.DriveType}");
Console.WriteLine($"获取驱动器上存储空间的总大小（以字节为单位)\t{driveInfo.TotalSize}");
Console.WriteLine($"驱动器可用空余\t{driveInfo.TotalFreeSpace}");
Console.WriteLine($"文件系统名称\t{driveInfo.DriveFormat}");
Console.WriteLine($"驱动器根目录\t{driveInfo.RootDirectory}");
```

### 转换大小单位

默认的获取文件或者文件夹或者驱动器的大小是以字节为单位的，这里有一个用于文件大小单位转换的方法，这个方法比较节省性能，是笔者常用的方法，仅供参考：

```c#
/// <summary>
/// 文件大小单位转换
/// </summary>
/// <param name="byteCount">字节大小</param>
/// <returns>根据字节大小返回适合的大小单位</returns>
private string GetFileSize(double byteCount)
{
    string size = "0 B";
    if (byteCount >= 1073741824.0)
        size = string.Format("{0:##.##}", byteCount / 1073741824.0) + " GB";
    else if (byteCount >= 1048576.0)
        size = string.Format("{0:##.##}", byteCount / 1048576.0) + " MB";
    else if (byteCount >= 1024.0)
        size = string.Format("{0:##.##}", byteCount / 1024.0) + " KB";
    else if (byteCount > 0 && byteCount < 1024.0)
        size = byteCount.ToString() + " B";
 
    return size;
}
```

这个方法会根据字节大小自动返回适合单位的大小，调用方式如下：

```c#
DriveInfo driveInfo = new DriveInfo("C"); // 实例化C盘的driveinfo
Console.WriteLine(GetFileSize(driveInfo.TotalSize)); // 117.96 GB
```

## 目录

> 类的静态方法对 [Directory](https://docs.microsoft.com/zh-cn/dotnet/api/system.io.directory?view=net-6.0) 所有方法执行安全检查。 如果要多次重用某个对象，请考虑改用的相应实例方法 [DirectoryInfo](https://docs.microsoft.com/zh-cn/dotnet/api/system.io.directoryinfo?view=net-6.0) ，因为安全检查并不总是必需的。
>
> 如果只执行一个与目录相关的操作，则使用静态 [Directory](https://docs.microsoft.com/zh-cn/dotnet/api/system.io.directory?view=net-6.0) 方法而不是相应的实例方法可能会更有效 [DirectoryInfo](https://docs.microsoft.com/zh-cn/dotnet/api/system.io.directoryinfo?view=net-6.0) 。 大多数 [Directory](https://docs.microsoft.com/zh-cn/dotnet/api/system.io.directory?view=net-6.0) 方法要求你正在操作的目录的路径。
>
> ---
>
> 来源：[Directory 类 (System.IO) | Microsoft Docs](https://docs.microsoft.com/zh-cn/dotnet/api/system.io.directory?view=net-6.0)



# LICENSE

已将所有引用其他文章之内容清楚明白地标注，其他部分皆为作者劳动成果。对作者劳动成果做以下声明：

copyright © 2021 苏月晟，版权所有。

<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br />本<span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" rel="dct:type">作品</span>由<span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName">苏月晟</span>采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。